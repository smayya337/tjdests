# WARNING: Do not edit this file manually! Edit ci/spec.yml and run ci/regen-workflow.py.

{"name": "CI", "on": ["push", "pull_request"], "defaults": {"run": {"shell": "bash"}}, "jobs": {"lint": {"runs-on": "ubuntu-latest", "strategy": {"matrix": {"python-version": ["3.12"]}}, "steps": [{"name": "Set up repo", "uses": "actions/checkout@v2"}, {"name": "Set up Python ${{ matrix.python-version }}", "uses": "actions/setup-python@v2", "with": {"python-version": "${{ matrix.python-version }}"}}, {"name": "Set up pip cache", "uses": "actions/cache@v4", "with": {"path": "~/.cache/pip", "key": "${{ matrix.python-version }}-pip-${{ hashFiles('requirements.txt', 'requirements-dev.txt') }}"}}, {"name": "Install APT dependencies", "run": "sudo apt-get -y install libyaml2-dev\n"}, {"name": "Set up venv", "run": "set -e\npip install --upgrade pip\npip install Cython\npip install -r requirements.txt\npip install -r requirements-dev.txt\n"}, {"name": "Check formatting with format.sh", "run": "set -e\n./scripts/format.sh\necho \"A failure means that you did not run format.sh\"\ntest -z \"$(git status --porcelain=v1 .)\"\n"}, {"name": "Check formatting with check.sh", "run": "./scripts/check.sh"}]}, "test": {"runs-on": "ubuntu-latest", "strategy": {"matrix": {"python-version": ["3.12"]}}, "steps": [{"name": "Set up repo", "uses": "actions/checkout@v2"}, {"name": "Set up Python ${{ matrix.python-version }}", "uses": "actions/setup-python@v2", "with": {"python-version": "${{ matrix.python-version }}"}}, {"name": "Set up pip cache", "uses": "actions/cache@v4", "with": {"path": "~/.cache/pip", "key": "${{ matrix.python-version }}-pip-${{ hashFiles('requirements.txt', 'requirements-dev.txt') }}"}}, {"name": "Install APT dependencies", "run": "sudo apt-get -y install libyaml2-dev\n"}, {"name": "Set up venv", "run": "set -e\npip install --upgrade pip\npip install Cython\npip install -r requirements.txt\npip install -r requirements-dev.txt\n"}, {"name": "copy secret.py", "run": "cp tjdests/settings/secret.sample.py tjdests/settings/secret.py"}, {"name": "Run test suite", "run": "coverage run ./manage.py test"}, {"name": "migrate database", "run": "./manage.py migrate"}, {"name": "Report coverage to Coveralls", "uses": "AndreMiras/coveralls-python-action@develop", "with": {"parallel": true}}]}, "finish_success": {"needs": ["lint", "test"], "runs-on": "ubuntu-latest", "steps": [{"name": "Tell Coveralls that parallel jobs have finished", "uses": "coverallsapp/github-action@master", "with": {"github-token": "${{ secrets.GITHUB_TOKEN }}", "parallel-finished": true}}]}}}