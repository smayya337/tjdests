{% extends "base.html" %}



{% block content %}
    <h2>Student Destinations by College</h2>

    <p><b>Note</b>: All data is self-reported. We do not make any claim as to the accuracy of this data.</p>

    {% if search_query %}
        <p>
            Only showing colleges matching {{ search_query }}.
            Navigate <a href="{% url "destinations:colleges" %}{% if selected_year != current_academic_year %}?year={{ selected_year }}{% endif %}">here</a> to reset.
        </p>
    {% endif %}

    <div class="container pb-3">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-8">
                <div class="input-group">
                    <div class="input-group-text"><label for="search"><i class="fas fa-search" aria-label="Search"></i></label></div>
                    {% if selected_year != current_academic_year %}<input type="hidden" name="year" value="{{ selected_year }}">{% endif %}
                    <input type="search" name="q" id="search" data-toggle="tooltip" data-bs-placement="bottom"
                           title="Filter by college name, city, or state abbreviation" aria-label="Search"
                           class="form-control" placeholder="Search" value="{{ search_query }}">
                </div>
            </div>
            <div class="col-md-4">
                <select id="graduation-year" class="form-select" onchange="changeGraduationYear(this.value)" aria-label="Graduation Year">
                    {% for year in available_years %}
                        <option value="{{ year }}" {% if year == selected_year %}selected{% endif %}>
                            Class of {{ year }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>
    
    <script>
        function changeGraduationYear(year) {
            const url = new URL(window.location);
            if (year == {{ current_academic_year }}) {
                url.searchParams.delete('year');
            } else {
                url.searchParams.set('year', year);
            }
            window.location.href = url.toString();
        }

        document.getElementById('search').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const url = new URL(window.location);
                const searchValue = this.value.trim();
                if (searchValue) {
                    url.searchParams.set('q', searchValue);
                } else {
                    url.searchParams.delete('q');
                }
                window.location.href = url.toString();
            }
        });
    </script>

    <div class="row py-3">
        <div class="col justify-content-center">
            {% include "pagination.html" %}
        </div>
    </div>

    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">University Name, Location</th>
                    <th scope="col">Total Applications</th>
                    <th scope="col">Attending</th>
                    <th scope="col">Admitted</th>
                    <th scope="col">Waitlisted</th>
                    <th scope="col">Waitlist-Admitted</th>
                    <th scope="col">Waitlist-Denied</th>
                    <th scope="col">Deferred</th>
                    <th scope="col">Deferred-Admitted</th>
                    <th scope="col">Deferred-Denied</th>
                    <th scope="col">Deferred-Waitlisted</th>
                    <th scope="col">Deferred-Waitlisted-Admitted</th>
                    <th scope="col">Deferred-Waitlisted-Denied</th>
                    <th scope="col">Denied</th>
                </tr>
            </thead>
            <tbody>
                {% for college in object_list %}
                    <tr>
                        <th scope="row"><a href="{% url "destinations:students" %}?college={{ college.id }}{% if selected_year != current_academic_year %}&year={{ selected_year }}{% endif %}">{{ college }}</a></th>
                        <td>{{ college.count_decisions }}</td>
                        <td>{{ college.count_attending }}</td>
                        <td>{{ college.count_admit }}</td>
                        <td>{{ college.count_waitlist }}</td>
                        <td>{{ college.count_waitlist_admit }}</td>
                        <td>{{ college.count_waitlist_deny }}</td>
                        <td>{{ college.count_defer }}</td>
                        <td>{{ college.count_defer_admit }}</td>
                        <td>{{ college.count_defer_deny }}</td>
                        <td>{{ college.count_defer_wl }}</td>
                        <td>{{ college.count_defer_wl_admit }}</td>
                        <td>{{ college.count_defer_wl_deny }}</td>
                        <td>{{ college.count_deny }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td>There is no data to display.</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="row py-3">
        <div class="col justify-content-center">
            {% include "pagination.html" %}
        </div>
    </div>

{% endblock %}
